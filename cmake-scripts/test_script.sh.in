#!/bin/bash

PART_CONFIG=$1
UNROLL_CONFIG=$2
PIPE_CONFIG=$3
CLOCK_CONFIG=$4


CURRENT_DIR=`pwd`
if ! [ -f "@TRACE_DATA@" ]
then
  echo "finds no @TRACE_DATA@, generate it!"
  cd @CMAKE_CURRENT_BINARY_DIR@
  @PROFILE_EXE@
  cd $CURRENT_DIR
fi

PARAEMETER_STRING="p${PART_CONFIG}_u${UNROLL_CONFIG}_P${PIPE_CONFIG}_${CLOCK_CONFIG}ns"
RUN_TEST_DIRECTORY="@CMAKE_CURRENT_BINARY_DIR@/sim/${PARAEMETER_STRING}"
CONFIG_FILE="${RUN_TEST_DIRECTORY}/config_${PARAEMETER_STRING}"


python @config_py@ @CMAKE_CURRENT_BINARY_DIR@ @f_TEST_NAME@ \
    $PART_CONFIG $UNROLL_CONFIG $PIPE_CONFIG $CLOCK_CONFIG && \
cd $RUN_TEST_DIRECTORY && \
@ALADDIN_EXECUTABLE@ @f_TEST_NAME@ @TRACE_DATA@ $CONFIG_FILE && \
cd $CURRENT_DIR
